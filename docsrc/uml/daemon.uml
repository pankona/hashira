@startuml

hide footbox

participant client    as c
participant daemon    as d
participant datastore as ds

c -> d : send(command-1)
d -> d : cache command-1
c <- d : ok

alt daemon is online

  note right of d : proceed on goroutine
  d -> ds : send(command-1)
  ds -> ds : apply(command-1)
  d <- ds : ok
  
  note right of ds: send notification\n because of update
  d <- ds : notify
  
  note right of d : fetch latest data\n from datastore
  d -> ds  : fetch(10 weeks)
  d <- ds  : chunk of data
  d -> d   : apply data to\n local document store

else daemon is offline

  d -> d : apply data to\n local document store\n (using cache)

end

note right of d : send notification\n because of update
c <- d   : notify
c -> d   : fetch(10 weeks)
c <- d   : chunk of data
c -> c   : render data

@enduml
