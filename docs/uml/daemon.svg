<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="806px" preserveAspectRatio="none" style="width:506px;height:806px;" version="1.1" viewBox="0 0 506 806" width="506px" zoomAndPan="magnify"><defs><filter height="300%" id="faa987aa4l0o5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#faa987aa4l0o5)" height="459" style="stroke: #000000; stroke-width: 2.0;" width="367" x="127" y="147"/><rect fill="#FFFFFF" height="79" style="stroke: none; stroke-width: 1.0;" width="367" x="127" y="527"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="36" y2="794"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="167" x2="167" y1="36" y2="794"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="327.5" x2="327.5" y1="36" y2="794"/><rect fill="#FEFECE" filter="url(#faa987aa4l0o5)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="15" y="22.3184">client</text><rect fill="#FEFECE" filter="url(#faa987aa4l0o5)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="137" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="144" y="22.3184">daemon</text><rect fill="#FEFECE" filter="url(#faa987aa4l0o5)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="287.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="294.5" y="22.3184">datastore</text><polygon fill="#A80036" points="155,61,165,65,155,69,159,65" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38" x2="161" y1="65" y2="65"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="45" y="61.4385">send(command-1)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="167" x2="209" y1="92" y2="92"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="209" y1="92" y2="105"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="209" y1="105" y2="105"/><polygon fill="#A80036" points="178,101,168,105,178,109,174,105" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="174" y="88.4385">cache command-1</text><polygon fill="#A80036" points="49,128,39,132,49,136,45,132" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="166" y1="132" y2="132"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="55" y="128.4385">ok</text><rect fill="none" height="459" style="stroke: #000000; stroke-width: 2.0;" width="367" x="127" y="147"/><polygon fill="#EEEEEE" points="127,147,196,147,196,152,186,162,127,162,127,147" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="142" y="159.4385">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="211" y="158.6787">[daemon is online]</text><polygon fill="#FBFB77" filter="url(#faa987aa4l0o5)" points="172,167,172,190,333,190,333,177,323,167,172,167" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="323" x2="323" y1="167" y2="177"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="333" x2="323" y1="177" y2="177"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="178" y="183.4385">proceed on goroutine</text><polygon fill="#A80036" points="316,214,326,218,316,222,320,218" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="167" x2="322" y1="218" y2="218"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="174" y="214.4385">send(command-1)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="328" x2="370" y1="245" y2="245"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="370" x2="370" y1="245" y2="258"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="329" x2="370" y1="258" y2="258"/><polygon fill="#A80036" points="339,254,329,258,339,262,335,258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="335" y="241.4385">apply(command-1)</text><polygon fill="#A80036" points="178,281,168,285,178,289,174,285" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="172" x2="327" y1="285" y2="285"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="184" y="281.4385">ok</text><polygon fill="#FBFB77" filter="url(#faa987aa4l0o5)" points="333,298,333,334,480,334,480,308,470,298,333,298" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="470" x2="470" y1="298" y2="308"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="480" x2="470" y1="308" y2="308"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="339" y="314.4385">send notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="346" y="327.4385">because of update</text><polygon fill="#A80036" points="178,358,168,362,178,366,174,362" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="172" x2="327" y1="362" y2="362"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="184" y="358.4385">notify</text><polygon fill="#FBFB77" filter="url(#faa987aa4l0o5)" points="172,375,172,411,312,411,312,385,302,375,172,375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="302" x2="302" y1="375" y2="385"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="312" x2="302" y1="385" y2="385"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="178" y="391.4385">fetch latest data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="185" y="404.4385">from datastore</text><polygon fill="#A80036" points="316,435,326,439,316,443,320,439" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="167" x2="322" y1="439" y2="439"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="174" y="435.4385">fetch(10 weeks)</text><polygon fill="#A80036" points="178,462,168,466,178,470,174,466" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="172" x2="327" y1="466" y2="466"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="184" y="462.4385">chunk of data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="167" x2="209" y1="506" y2="506"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="209" y1="506" y2="519"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="209" y1="519" y2="519"/><polygon fill="#A80036" points="178,515,168,519,178,523,174,519" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="174" y="489.4385">apply data to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="181" y="502.4385">local document store</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="127" x2="494" y1="528" y2="528"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="132" y="537.6787">[daemon is offline]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="167" x2="209" y1="585" y2="585"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="209" y1="585" y2="598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="209" y1="598" y2="598"/><polygon fill="#A80036" points="178,594,168,598,178,602,174,598" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="174" y="555.4385">apply data to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="181" y="568.4385">local document store</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="181" y="581.4385">(using cache)</text><polygon fill="#FBFB77" filter="url(#faa987aa4l0o5)" points="172,618,172,654,319,654,319,628,309,618,172,618" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309" x2="309" y1="618" y2="628"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="319" x2="309" y1="628" y2="628"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="178" y="634.4385">send notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="185" y="647.4385">because of update</text><polygon fill="#A80036" points="49,678,39,682,49,686,45,682" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="166" y1="682" y2="682"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="55" y="678.4385">notify</text><polygon fill="#A80036" points="155,705,165,709,155,713,159,709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38" x2="161" y1="709" y2="709"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="45" y="705.4385">fetch(10 weeks)</text><polygon fill="#A80036" points="49,732,39,736,49,740,45,736" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="166" y1="736" y2="736"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="55" y="732.4385">chunk of data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="38" x2="80" y1="763" y2="763"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="80" x2="80" y1="763" y2="776"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39" x2="80" y1="776" y2="776"/><polygon fill="#A80036" points="49,772,39,776,49,780,45,776" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="45" y="759.4385">render data</text><!--
@startuml

hide footbox

participant client    as c
participant daemon    as d
participant datastore as ds

c -> d : send(command-1)
d -> d : cache command-1
c <- d : ok

alt daemon is online

note right of d : proceed on goroutine
d -> ds : send(command-1)
ds -> ds : apply(command-1)
d <- ds : ok

note right of ds: send notification\n because of update
d <- ds : notify

note right of d : fetch latest data\n from datastore
d -> ds  : fetch(10 weeks)
d <- ds  : chunk of data
d -> d   : apply data to\n local document store

else daemon is offline

d -> d : apply data to\n local document store\n (using cache)

end

note right of d : send notification\n because of update
c <- d   : notify
c -> d   : fetch(10 weeks)
c <- d   : chunk of data
c -> c   : render data


@enduml

PlantUML version 1.2017.14(Mon Jun 05 18:56:32 JST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_144-b01
Operating System: Linux
OS Version: 4.12.14-1-MANJARO
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>