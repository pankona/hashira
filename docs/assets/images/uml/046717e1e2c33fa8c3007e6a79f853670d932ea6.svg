<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="779px" preserveAspectRatio="none" style="width:957px;height:779px;" version="1.1" viewBox="0 0 957 779" width="957px" zoomAndPan="magnify"><defs><filter height="300%" id="f1eum7tf2ufv3l" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="45" x2="45" y1="36" y2="767"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="195" x2="195" y1="36" y2="767"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="446.5" x2="446.5" y1="36" y2="767"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="618" x2="618" y1="36" y2="767"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="870" x2="870" y1="36" y2="767"/><rect fill="#FEFECE" filter="url(#f1eum7tf2ufv3l)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="15" y="22.3184">client 1</text><rect fill="#FEFECE" filter="url(#f1eum7tf2ufv3l)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="158" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="165" y="22.3184">daemon 1</text><rect fill="#FEFECE" filter="url(#f1eum7tf2ufv3l)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="406.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="413.5" y="22.3184">datastore</text><rect fill="#FEFECE" filter="url(#f1eum7tf2ufv3l)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="581" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="588" y="22.3184">daemon 2</text><rect fill="#FEFECE" filter="url(#f1eum7tf2ufv3l)" height="28" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="833" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="840" y="22.3184">client 2</text><polygon fill="#FBFB77" filter="url(#f1eum7tf2ufv3l)" points="200,51,200,74,403,74,403,61,393,51,200,51" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="393" x2="393" y1="51" y2="61"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="403" x2="393" y1="61" y2="61"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="206" y="67.4385">assume daemon 1 is offline</text><polygon fill="#A80036" points="183,98,193,102,183,106,187,102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45" x2="189" y1="102" y2="102"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="52" y="98.4385">command-1 (cached)</text><polygon fill="#A80036" points="183,125,193,129,183,133,187,129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45" x2="189" y1="129" y2="129"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="52" y="125.4385">command-2 (cached)</text><polygon fill="#FBFB77" filter="url(#f1eum7tf2ufv3l)" points="200,142,200,178,522,178,522,152,512,142,200,142" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="512" x2="512" y1="142" y2="152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="522" x2="512" y1="152" y2="152"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="206" y="158.4385">assume daemon 1 is online,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="213" y="171.4385">then send all cached commands to datastore</text><polygon fill="#A80036" points="435,202,445,206,435,210,439,206" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="195" x2="441" y1="206" y2="206"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="202" y="202.4385">command-1, 2 as JSON</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="447" x2="489" y1="233" y2="233"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="489" x2="489" y1="233" y2="246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="489" y1="246" y2="246"/><polygon fill="#A80036" points="458,242,448,246,458,250,454,246" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="454" y="229.4385">apply command-1, 2</text><polygon fill="#A80036" points="435,269,445,273,435,277,439,273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="195" x2="441" y1="273" y2="273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="202" y="269.4385">fetch(10 weeks)</text><polygon fill="#A80036" points="206,309,196,313,206,317,202,313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="446" y1="313" y2="313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="212" y="296.4385">chunk of data as JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="219" y="309.4385">10 weeks of data for example</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="195" x2="237" y1="340" y2="340"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="237" x2="237" y1="340" y2="353"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="196" x2="237" y1="353" y2="353"/><polygon fill="#A80036" points="206,349,196,353,206,357,202,353" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="202" y="336.4385">store JSON to local document store</text><polygon fill="#FBFB77" filter="url(#f1eum7tf2ufv3l)" points="623,366,623,389,826,389,826,376,816,366,623,366" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="816" y1="366" y2="376"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="826" x2="816" y1="376" y2="376"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="629" y="382.4385">assume daemon 2 is offline</text><polygon fill="#A80036" points="629,413,619,417,629,421,625,417" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623" x2="869" y1="417" y2="417"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="635" y="413.4385">command-3 (cached)</text><polygon fill="#A80036" points="629,440,619,444,629,448,625,444" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623" x2="869" y1="444" y2="444"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="635" y="440.4385">command-4 (cached)</text><polygon fill="#FBFB77" filter="url(#f1eum7tf2ufv3l)" points="623,457,623,493,945,493,945,467,935,457,623,457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="935" x2="935" y1="457" y2="467"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="945" x2="935" y1="467" y2="467"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="629" y="473.4385">assume daemon 2 is online,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="636" y="486.4385">then send all cached commands to datastore</text><polygon fill="#A80036" points="458,517,448,521,458,525,454,521" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452" x2="617" y1="521" y2="521"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="464" y="517.4385">command-3, 4 as JSON</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="447" x2="489" y1="548" y2="548"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="489" x2="489" y1="548" y2="561"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="489" y1="561" y2="561"/><polygon fill="#A80036" points="458,557,448,561,458,565,454,561" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="454" y="544.4385">apply command-3, 4</text><polygon fill="#A80036" points="458,584,448,588,458,592,454,588" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452" x2="617" y1="588" y2="588"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="464" y="584.4385">fetch(10 weeks)</text><polygon fill="#A80036" points="606,611,616,615,606,619,610,615" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="447" x2="612" y1="615" y2="615"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="454" y="611.4385">chunk of data as JSON</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="618" x2="660" y1="642" y2="642"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="660" x2="660" y1="642" y2="655"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="660" y1="655" y2="655"/><polygon fill="#A80036" points="629,651,619,655,629,659,625,655" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="625" y="638.4385">store JSON to local document store</text><polygon fill="#A80036" points="435,678,445,682,435,686,439,682" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="195" x2="441" y1="682" y2="682"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="202" y="678.4385">fetch(10 weeks)</text><polygon fill="#A80036" points="206,705,196,709,206,713,202,709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="446" y1="709" y2="709"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="212" y="705.4385">chunk o data as JSON</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="195" x2="237" y1="736" y2="736"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="237" x2="237" y1="736" y2="749"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="196" x2="237" y1="749" y2="749"/><polygon fill="#A80036" points="206,745,196,749,206,753,202,749" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="202" y="732.4385">store JSON to local document store</text><!--
@startuml

hide footbox

participant "client 1"  as c1
participant "daemon 1"  as d1
participant "datastore" as ds
participant "daemon 2"  as d2
participant "client 2"  as c2

note right of d1 : assume daemon 1 is offline
c1 -> d1 : command-1 (cached)
c1 -> d1 : command-2 (cached)

note right of d1 : assume daemon 1 is online,\n then send all cached commands to datastore
d1 -> ds : command-1, 2 as JSON

ds -> ds : apply command-1, 2

d1 -> ds : fetch(10 weeks)
d1 <- ds : chunk of data as JSON\n 10 weeks of data for example
d1 -> d1 : store JSON to local document store

note right of d2 : assume daemon 2 is offline
d2 <- c2 : command-3 (cached)
d2 <- c2 : command-4 (cached)

note right of d2 : assume daemon 2 is online,\n then send all cached commands to datastore
ds <- d2 : command-3, 4 as JSON

ds -> ds : apply command-3, 4

ds <- d2 : fetch(10 weeks)
ds -> d2 : chunk of data as JSON
d2 -> d2 : store JSON to local document store

d1 -> ds : fetch(10 weeks)
d1 <- ds : chunk o data as JSON
d1 -> d1 : store JSON to local document store

@enduml

PlantUML version 1.2017.15(Tue Jul 04 01:45:34 JST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_144-b01
Operating System: Linux
OS Version: 4.12.14-1-MANJARO
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>